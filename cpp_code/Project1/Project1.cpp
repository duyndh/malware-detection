// Project1.cpp : This file contains the 'main' function. Program execution begins and ends there.
//

#include "pch.h"
#include <iostream>

void WINAPI AsmToGraph(const std::string& strAsmFilePath, bool bIdaAsm);
void WINAPI FileToGraph(const std::string& strPeFilePath);
void WINAPI FileToGraphCsv(LPSTR strPeFilePath, LPSTR strOutputFileName);
void WINAPI BuildGraphDataset(const std::string& strInputDirectory, const std::string& strOutputDirectory);

typedef decltype(&AsmToGraph) FN_AsmToGraph;
typedef decltype(&FileToGraph) FN_FileToGraph;
typedef decltype(&FileToGraphCsv) FN_FileToGraphCsv;
typedef decltype(&BuildGraphDataset) FN_BuildGraphDataset;

int main()
{
	HMODULE hModule = LoadLibraryA("Project2.dll");

	/*FN_AsmToGraph fnAsmToGraph = (FN_AsmToGraph)GetProcAddress(hModule, "AsmToGraph");
	fnAsmToGraph("c:\\temp\\ERxv2Sm37oVrpwNdThsk.asm", true);*/
	
	/*FN_FileToGraph fnFileToGraph = (FN_FileToGraph)GetProcAddress(hModule, "FileToGraph");
	fnFileToGraph("c:\\temp\\procexp64.exe");*/

	/*FN_FileToGraphCsv fnFileToGraphCsv = (FN_FileToGraphCsv)GetProcAddress(hModule, "FileToGraphCsv");
	fnFileToGraphCsv((LPSTR)"c:\\temp\\Test\\Virus_Win32_Atav_2073", (LPSTR)"{223CDE67-DAF7-4984-9D37-876B9617D302}");*/

	FN_BuildGraphDataset fnBuildGraphDataset = (FN_BuildGraphDataset)GetProcAddress(hModule, "BuildGraphDataset");
	fnBuildGraphDataset("F:\\Malware", "F:\\Malware_Graph");

	system("pause");
	
	return 0;
}

// Run program: Ctrl + F5 or Debug > Start Without Debugging menu
// Debug program: F5 or Debug > Start Debugging menu

// Tips for Getting Started: 
//   1. Use the Solution Explorer window to add/manage files
//   2. Use the Team Explorer window to connect to source control
//   3. Use the Output window to see build output and other messages
//   4. Use the Error List window to view errors
//   5. Go to Project > Add New Item to create new code files, or Project > Add Existing Item to add existing code files to the project
//   6. In the future, to open this project again, go to File > Open > Project and select the .sln file
