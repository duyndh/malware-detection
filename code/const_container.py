import platform
import os
import enum


class Action(enum.Enum):
    COLLECT = 1
    CONVERT = 2
    TRAIN = 3
    VISUALIZE = 4

ACTION = Action.COLLECT

DATASET_VERSION = 1
BENIGN_DATASET_VERSION = 2
MALWARE_DATASET_VERSION = 2
USING_COLAB = False

COLLECT_BENIGN = False
RAW_FILE_COUNT_LIMIT = 50000
OPCODE_FILE_COUNT_LIMIT = 50000

TRAIN_FILE_COUNT_LIMIT = 2

TRY_BENIGN_FILE_COUNT_LIMIT = TRAIN_FILE_COUNT_LIMIT
TRY_MALWARE_FILE_COUNT_LIMIT = TRAIN_FILE_COUNT_LIMIT

FILE_SIZE_LIMIT = 1024 * 1024 * 100
TEST_RATIO = 0.1

MAX_FEATURE_SIZE = 256
REDUCED_FEATURE_SIZE = 64


class FeatureMethod(enum.Enum):
    Raw = 1
    TF = 2
    TF_IDF = 3

TRAINING_FEATURE_METHOD = FeatureMethod.TF_IDF
TRAINING_SEQUENCE_LENGTH = 2

ROOT_DIR = ""
ROOT_MALWARE_DATASET_DIR = ""
ROOT_BENIGN_DATASET_DIR = ""
if platform.system() == 'Linux' and not USING_COLAB:
    ROOT_DIR = os.path.expanduser("~/Downloads")
    ROOT_BENIGN_DATASET_DIR = ROOT_DIR
    ROOT_MALWARE_DATASET_DIR = ROOT_DIR

elif platform.system() == 'Windows' and not USING_COLAB:
    ROOT_DIR = os.path.expandvars("%SystemDrive%\\Temp")
    ROOT_BENIGN_DATASET_DIR = ROOT_DIR
    ROOT_MALWARE_DATASET_DIR = ROOT_DIR

else:
    ROOT_DIR = "./"
    ROOT_BENIGN_DATASET_DIR = "/content/drive/MyDrive/Colab Notebooks/BenignDataset/V" + str(DATASET_VERSION)
    ROOT_MALWARE_DATASET_DIR = "/content/drive/MyDrive/Colab Notebooks/MalwareDataset/V" + str(DATASET_VERSION)

RAW_DATASET_CSV_FILE_NAME = "_dataset.csv"
TMP_RAW_FILE_PATH = os.path.join(ROOT_DIR, "_tmp_raw.csv")
TMP_FILTERED_FILE_PATH = os.path.join(ROOT_DIR, "_tmp_data.csv")


BENIGN_SCAN_DIRS = [
    os.path.expandvars("%ProgramFiles%"),
    os.path.expandvars("%ProgramFiles(x86)%"),
    os.path.expandvars("%WinDir%")
]

MALWARE_SCAN_DIRS = [
    os.path.join(ROOT_DIR, "Virus.Win")
]

BENIGN_SCAN_EXTS = [".acm", ".ax", ".cpl", ".dll", ".drv", ".efi", ".exe", ".mui", ".ocx", ".scr", ".sys", ".tsp"]
MALWARE_SCAN_EXTS = None

RAW_BENIGN_DATASET_DIR_X86 = os.path.join(ROOT_DIR, "benign_dataset_x86")
RAW_BENIGN_DATASET_DIR_X64 = os.path.join(ROOT_DIR, "benign_dataset_x64")
RAW_MALWARE_DATASET_DIR_X86 = os.path.join(ROOT_DIR, "malware_dataset_x86")
RAW_MALWARE_DATASET_DIR_X64 = os.path.join(ROOT_DIR, "malware_dataset_x64")

OPCODE_BENIGN_DATASET_CSV_FILE_PATH_X86 = os.path.join(ROOT_BENIGN_DATASET_DIR, "benign_opcodes_x86.csv")
OPCODE_BENIGN_DATASET_CSV_FILE_PATH_X64 = os.path.join(ROOT_BENIGN_DATASET_DIR, "benign_opcodes_x64.csv")

OPCODE_MALWARE_DATASET_CSV_FILE_PATH_X86 = os.path.join(ROOT_MALWARE_DATASET_DIR, "malware_opcodes_x86.csv")
OPCODE_MALWARE_DATASET_CSV_FILE_PATH_X64 = os.path.join(ROOT_MALWARE_DATASET_DIR, "malware_opcodes_x64.csv")

X64_MACHINE = 0x8664
X86_MACHINE = 0x14c