import os
import glob
import csv

if __name__ == '__main__':

    pe_extensions = [".acm", ".ax", ".cpl", ".dll", ".drv", ".efi", ".exe", ".mui", ".ocx", ".scr", ".sys", ".tsp"]
    scan_dirs = [os.path.expandvars("%ProgramFiles%"), os.path.expandvars("%ProgramFiles(x86)%")]
    csv_file_path = os.path.expandvars("%SystemDrive%\\Temp\\_full_files.csv")

    file_paths = []

    percentage = 0
    print(0, "%")

    total_items_count = len(scan_dirs) * len(pe_extensions)
    item_index = 0

    for dir_index, scan_dir in enumerate(scan_dirs):
        for ext_index, extension in enumerate(pe_extensions):

            if (int)(item_index * 100 / total_items_count) > percentage:
                percentage = (int)(item_index * 100 / total_items_count)
                print(percentage, "%")

            find_pattern = os.path.join(scan_dir, "**", "*" + extension)
            file_paths += glob.glob(find_pattern,  recursive=True)

            item_index += 1

    print("Saving...")

    with open(csv_file_path, 'w', newline='') as csv_file:
        writer = csv.DictWriter(csv_file, fieldnames=['file_path'])
        writer.writeheader()
        for path in file_paths:
            writer.writerow({"file_path": path})

    print(100, "%")
    print("DONE")

    pass