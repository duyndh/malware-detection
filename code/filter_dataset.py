# This is a sample Python script.

# Press Shift+F10 to execute it or replace it with your code.
# Press Double Shift to search everywhere for classes, files, tool windows, actions, and settings.

import os
import pefile
import csv

# Press the green button in the gutter to run the script.
if __name__ == '__main__':

    dataset_dir = os.path.expanduser("~/Downloads/Virus.Win")
    csv_file_name = "_pe.csv"

    pe_file_names = []
    non_pe_file_names = []
    percentage = 0
    print(0, "%")

    for root_path, directory_names, file_names in os.walk(dataset_dir):
        for file_index, file_name in enumerate(file_names):

            if (int)(file_index * 100 / len(file_names)) > percentage:
                percentage = (int)(file_index * 100 / len(file_names))
                print(percentage, "%")

            file_path = os.path.join(root_path, file_name)

            try:
                pe = pefile.PE(file_path)
                pe_file_names.append(file_name)
            except:
                non_pe_file_names.append(file_name)

        break

    out_file_path = os.path.join(dataset_dir, csv_file_name)

    with open(out_file_path, 'w', newline='') as csv_file:
        writer = csv.DictWriter(csv_file, fieldnames=['file_name'])
        writer.writeheader()
        for name in pe_file_names:
            writer.writerow({"file_name": name})

    print("DONE")
    pass

# See PyCharm help at https://www.jetbrains.com/help/pycharm/
