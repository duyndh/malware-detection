// TestApp.cpp : This file contains the 'main' function. Program execution begins and ends there.
//

#include "pch.h"
#include <iostream>
#include <string>

bool WINAPI DisassemblyFile(LPSTR input_file_path, LPSTR asm_file_path, LPSTR output_file_path);
typedef decltype(&DisassemblyFile) FN_DisassemblyFile;

bool WINAPI BuildInstructionsGraph(LPSTR input_file_path, LPSTR output_file_path);
typedef decltype(&BuildInstructionsGraph) FN_BuildInstructionsGraph;

bool WINAPI BuildGraphFromFile(LPSTR input_file_path, LPSTR asm_file_path, LPSTR output_file_path);
typedef decltype(&BuildGraphFromFile) FN_BuildGraphFromFile;


int main()
{
	HMODULE hLib = LoadLibraryA("NativeLib.dll");
	FN_DisassemblyFile fnDisassemblyFile = (FN_DisassemblyFile)GetProcAddress(hLib, "DisassemblyFile");
	FN_BuildInstructionsGraph fnBuildInstructionsGraph = (FN_BuildInstructionsGraph)GetProcAddress(hLib, "BuildInstructionsGraph");
	FN_BuildGraphFromFile fnBuildGraphFromFile = (FN_BuildGraphFromFile)GetProcAddress(hLib, "BuildGraphFromFile");
	
	//"c:\\temp\\asm\\01kcPWA9K2BOxQeS5Rju.bytes";
	std::string bytes_file_path = "c:\\temp\\asm\\mspaint.exe";
	//"c:\\temp\\asm\\01kcPWA9K2BOxQeS5Rju.asm";
	std::string asm_file_path = "";
	
	std::string standard_file_path = "c:\\temp\\asmout\\c_temp_asm_Fo3l7eAEM4XDmKyIV9tj_bytes.scsv";
	std::string graph_file_path = "c:\\temp\\asmout\\graph.csv";

	bool result = false;
	
	//bool result = fnDisassemblyFile((LPSTR)bytes_file_path.c_str(), (LPSTR)asm_file_path.c_str(), (LPSTR)standard_file_path.c_str());
	result = fnBuildInstructionsGraph((LPSTR)standard_file_path.c_str(), (LPSTR)graph_file_path.c_str());

	//bool result = fnBuildGraphFromFile((LPSTR)bytes_file_path.c_str(), (LPSTR)asm_file_path.c_str(), (LPSTR)graph_file_path.c_str());
	
    return 0;
}

// Run program: Ctrl + F5 or Debug > Start Without Debugging menu
// Debug program: F5 or Debug > Start Debugging menu

// Tips for Getting Started: 
//   1. Use the Solution Explorer window to add/manage files
//   2. Use the Team Explorer window to connect to source control
//   3. Use the Output window to see build output and other messages
//   4. Use the Error List window to view errors
//   5. Go to Project > Add New Item to create new code files, or Project > Add Existing Item to add existing code files to the project
//   6. In the future, to open this project again, go to File > Open > Project and select the .sln file
