using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.IO;
using System.Linq;
using System.Reflection;
using System.Text;
using System.Threading.Tasks;
using System.Windows.Forms;
using WindowsFormsApp1.Controllers;
using WindowsFormsApp1.Controls;
using WindowsFormsApp1.Forms;
using WindowsFormsApp1.UserControls;
using static WindowsFormsApp1.Controllers.Storage;

namespace WindowsFormsApp1
{
    public partial class Home : Form
    {
        private Home()
        {
            InitializeComponent();
        }

        private static Home _instance = null;

        public static Home GetInstance()
        {
            if (_instance == null)
                _instance = new Home();

            return _instance;
        }

        private string _dataLocation;
        public string GetDataLocation() { return _dataLocation; }

        private const NavigationOptionEnum DEFAULT_NAV_OPTION = NavigationOptionEnum.FILES;
        private NavigationOptionEnum _currentNavOption = NavigationOptionEnum.FILES;
        private Color DEFAULT_SELECTED_NAV_BUTTON_BACK_COLOR = SystemColors.GradientActiveCaption;

        private Button[] _navButtons = null;        
        private UserControl[] _navUserControls = null;

        public FilesScanningController filesScanningControler;
        public ProcessesScanningController processesScanningController;
        public MiningController miningController;
        public TrainingController trainingController;
        public SettingController settingController;
        
        protected override void OnLoad(EventArgs e)
        {
            _navButtons = new Button[]
            {
                this.filesButton,
                this.processesButton,
                this.miningButton,
                this.trainingButton,
                this.settingsButton
            };
            foreach (Button btn in _navButtons)
            {
                if (btn != null)
                {
                    btn.FlatAppearance.MouseOverBackColor = btn.FlatAppearance.MouseDownBackColor = DEFAULT_SELECTED_NAV_BUTTON_BACK_COLOR;
                }
            }

            _navUserControls = new UserControl[]
            {
                new FilesScanningUserControl(),
                new ProcessesScanningUserControl(),
                new MiningUserControl(),
                new TrainingUserControl(),
                new SettingUserControl()
            };

            _navButtons[(int)DEFAULT_NAV_OPTION].PerformClick();
            filesScanningControler = new FilesScanningController((FilesScanningUserControl)_navUserControls[(int)NavigationOptionEnum.FILES]);
            processesScanningController = new ProcessesScanningController((ProcessesScanningUserControl)_navUserControls[(int)NavigationOptionEnum.PROCESSES]);
            miningController = new MiningController((MiningUserControl)_navUserControls[(int)NavigationOptionEnum.MINING]);
            trainingController = new TrainingController((TrainingUserControl)_navUserControls[(int)NavigationOptionEnum.TRAINING]);
            settingController = new SettingController((SettingUserControl)_navUserControls[(int)NavigationOptionEnum.SETTINGS]);


            _dataLocation = Path.Combine(Directory.GetParent(Assembly.GetExecutingAssembly().Location).FullName, "Data");
            if (!Directory.Exists(_dataLocation))
                Directory.CreateDirectory(_dataLocation);
        }

        private void RefressNavButtons()
        {
            foreach (Button btn in _navButtons)
            {
                if (btn != null)
                {
                    btn.BackColor = SystemColors.Control;
                }
            }
            this.splitContainer1.Panel2.Controls.Clear();
        }

        private void filesButton_Click(object sender, EventArgs e)
        {
            this._currentNavOption = NavigationOptionEnum.FILES;
            RefressNavButtons();

            this._navButtons[(int)_currentNavOption].BackColor = DEFAULT_SELECTED_NAV_BUTTON_BACK_COLOR;
            this.splitContainer1.Panel2.Controls.Add(_navUserControls[(int)_currentNavOption]);
        }

        private void processesButton_Click(object sender, EventArgs e)
        {
            this._currentNavOption = NavigationOptionEnum.PROCESSES;
            RefressNavButtons();

            this._navButtons[(int)_currentNavOption].BackColor = DEFAULT_SELECTED_NAV_BUTTON_BACK_COLOR;
            this.splitContainer1.Panel2.Controls.Add(_navUserControls[(int)_currentNavOption]);
        }

        private void miningButton_Click(object sender, EventArgs e)
        {
            this._currentNavOption = NavigationOptionEnum.MINING;
            RefressNavButtons();

            this._navButtons[(int)_currentNavOption].BackColor = DEFAULT_SELECTED_NAV_BUTTON_BACK_COLOR;            
            this.splitContainer1.Panel2.Controls.Add(_navUserControls[(int)_currentNavOption]);
        }

        private void trainingButton_Click(object sender, EventArgs e)
        {
            this._currentNavOption = NavigationOptionEnum.TRAINING;
            RefressNavButtons();

            this._navButtons[(int)_currentNavOption].BackColor = DEFAULT_SELECTED_NAV_BUTTON_BACK_COLOR;
            this.splitContainer1.Panel2.Controls.Add(_navUserControls[(int)_currentNavOption]);
        }

        private void settingsButton_Click(object sender, EventArgs e)
        {
            this._currentNavOption = NavigationOptionEnum.SETTINGS;
            RefressNavButtons();

            this._navButtons[(int)_currentNavOption].BackColor = DEFAULT_SELECTED_NAV_BUTTON_BACK_COLOR;
            this.splitContainer1.Panel2.Controls.Add(_navUserControls[(int)_currentNavOption]);
        }
    }
}
