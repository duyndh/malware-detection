using System;
using System.Collections.Generic;
using System.Linq;
using System.Runtime.InteropServices;
using System.Text;
using System.Threading.Tasks;

namespace WindowsFormsApp1.Controllers
{
    public class Storage
    {
        public enum FileTypeEnum
        {
            Files,
            Directories
        }
        public enum FileFormatEnum
        {
            Raw,
            Assembly,
            Standard,
            Graph,
            Count
        }
        public enum NavigationOptionEnum
        {
            NONE,
            FILES,
            PROCESSES,
            MINING,
            TRAINING,
            SETTINGS,
        }
        public enum LogTypeEnum
        {
            INFO,
            WARNING,
            ERROR,
        }
        public enum FeatureTypeEnum
        {
            TF,
            TF_IDF,
            PR
        }
        public enum ModeEnum
        {
            MINE,
            TRAIN,
            SCAN
        }

        public static readonly int MAX_STACK_SIZE = 64 * 1024 * 1024;
        public static readonly int MAX_PATH = 250;

        public static readonly string ASM_EXT = ".asm";
        public static readonly string BYTES_EXT = ".bytes";
        public static readonly string STANDARD_EXT = ".scsv";
        public static readonly string GRAPH_EXT = ".gcsv";

        public static readonly string[] PE_EXTS = { ".acm", ".ax", ".cpl", ".dll", ".drv", ".efi", ".exe", ".mui", ".ocx", ".scr", ".sys", ".tsp" };

        public static readonly HashSet<FileFormatEnum>[] DATA_FORMAT_DIRECTIONS = new HashSet<FileFormatEnum>[]
        {
            new HashSet<FileFormatEnum>() { FileFormatEnum.Standard, FileFormatEnum.Graph },
            new HashSet<FileFormatEnum>() { FileFormatEnum.Standard, FileFormatEnum.Graph },
            new HashSet<FileFormatEnum>() { FileFormatEnum.Graph },
            new HashSet<FileFormatEnum>() { }
        };

        public static readonly string TEMP_DIR = Environment.ExpandEnvironmentVariables("%Temp%");
        public static readonly string APP_SETTINGS_FILE_NAME = "settings.json";
        public static readonly string FILES_HISTORY_FILE_NAME = "file_history.json";

        public static readonly string MODE_ID_ENV_NAME = "EDITH_mode_id";

        public static readonly string CLASSIFIER_PATH_ENV_NAME = "EDITH_clf_path";
        public static readonly string SCALER_PATH_ENV_NAME = "EDITH_scl_path";
        public static readonly string DECOMPOSITION_PATH_ENV_NAME = "EDITH_dcp_path";
        public static readonly string EXTRA_PATH_ENV_NAME = "EDITH_ext_path";

        public static readonly string TARGET_TYPE_ID_ENV_NAME = "EDITH_target_type_id";
        public static readonly string TARGET_PATHS_ENV_NAME = "EDITH_target_paths";

        public static readonly string FEATURE_ID_ENV_NAME = "EDITH_feature_id";
        public static readonly string SEQUENCE_LEN_ENV_NAME = "EDITH_sequence_len";

        [DllImport("NativeLib.dll")]
        public extern static void Test();

        [DllImport("NativeLib.dll")]
        public extern static bool DisassemblyFile(string input_file_path, string asm_file_path, string output_file_path);

        [DllImport("NativeLib.dll")]
        public extern static bool BuildInstructionsGraph(string input_file_path, string output_file_path);

        [DllImport("NativeLib.dll")]
        public extern static bool BuildGraphFromFile(string input_file_path, string asm_file_path, string output_file_path);

        public class AppSettings
        {
            public string DataScalerPath;
            public string DataDecompositionPath;
            public string ClassifierPath;
            public string ExtraDataPath;
            public string ConfigPath;
        }

        public class FileHistoryRecord
        {
            public FileHistoryRecord(int _id, string _filePath, FileFormatEnum _format, bool _isMalware) 
            {
                Id = _id; FilePath = _filePath; Format = _format; IsMalware = _isMalware;
            }

            public int Id;
            public string FilePath;
            public FileFormatEnum Format;
            public bool IsMalware;
        }
    }
}
