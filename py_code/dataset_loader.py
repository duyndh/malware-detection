import csv
import base64
import pandas as pd


class DatasetLoader:

    @staticmethod
    def load_graph(csv_path):

        graph = []

        data_frames = pd.read_csv(csv_path)

        for row_index in range(len(data_frames)):

            opcode = int(str(data_frames["O"][row_index]), 16)
            if pd.isna(data_frames["N"][row_index]):
                raw_next_arr = ""
            else:
                raw_next_arr = data_frames["N"][row_index]

            if raw_next_arr != "":
                bytes = bytearray(base64.b64decode(raw_next_arr))
                next_arr = [bytes[i:i + 4] for i in range(0, len(bytes), 4)]
                next_id_arr = []
                for next_bytes in next_arr:
                    next_id_arr.append(int.from_bytes(next_bytes, byteorder='little'))
                pass
            else:
                next_id_arr = []

            graph.append({"opcode": opcode, "next": next_id_arr})

            pass



        return graph

