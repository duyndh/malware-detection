import csv
import base64


class DatasetLoader:

    @staticmethod
    def load_graph(csv_path):
        graph = []

        with open(csv_path, newline='') as csv_file:

            reader = csv.DictReader(csv_file)
            data = list(reader)

            for row_index, row in enumerate(data):

                opcode = int(row['O'], 16)
                raw_next_arr = row["N"]

                if raw_next_arr != "":
                    bytes = bytearray(base64.b64decode(raw_next_arr))
                    next_arr = [bytes[i:i + 4] for i in range(0, len(bytes), 4)]
                    next_id_arr = []
                    for next_bytes in next_arr:
                        next_id_arr.append(int.from_bytes(next_bytes, byteorder='little'))
                    pass
                else:
                    next_id_arr = []

                graph.append({"opcode": opcode, "next": next_id_arr})

                pass

        return graph

